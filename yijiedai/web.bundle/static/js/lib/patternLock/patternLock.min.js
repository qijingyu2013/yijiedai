/*
	patternLock.js v 0.1.2
	Author: Sudhanshu Yadav
	Copyright (c) 2013 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
	Demo on: ignitersworld.com/lab/patternLock.html
*/
;(function(){function o(e){var t=e.holder,n=e.option,r=n.matrix,i=n.margin,s=n.radius;html=['<ul class="patt-wrap" style="padding:'+i+'px">'];for(var o=0,u=r[0]*r[1];o<u;o++){html.push('<li class="patt-circ" style="margin:'+i+"px; width : "+s*2+"px; height : "+s*2+"px; -webkit-border-radius: "+s+"px; -moz-border-radius: "+s+"px; border-radius: "+s+'px; "><div class="patt-dots"></div></li>')}html.push("</ul>");t.html(html.join("")).css({width:r[1]*(s*2+i*2)+i*2+"px",height:r[0]*(s*2+i*2)+i*2+"px"});e.pattCircle=e.holder.find(".patt-circ")}function u(e,t,n,r){var i=t-e,s=r-n;return{length:Math.ceil(Math.sqrt(i*i+s*s)),angle:Math.round(Math.atan2(s,i)*180/Math.PI)}}function c(){}function h(e,n){var r=this,u=r.token=Math.random(),f=s[u]=new c,l=f.holder=$(e);if(l.length==0)return;f.object=r;n=f.option=$.extend({},h.defaults,n);o(f);l.addClass("patt-holder");if(l.css("position")=="static")l.css("position","relative");l.on(t,function(e){a.call(this,e,r)});f.option.onDraw=n.onDraw||i;var p=n.mapper;if(typeof p=="object"){f.mapperFunc=function(e){return p[e]}}else if(typeof p=="function"){f.mapperFunc=p}else{f.mapperFunc=i}f.option.mapper=null}var e=!!("ontouchstart"in window),t=e?"touchstart":"mousedown",n=e?"touchend":"mouseup",r=e?"touchmove":"mousemove",i=function(){},s={};var a=function(e,t){e.preventDefault();var i=s[t.token];if(!i.option.patternVisible){i.holder.addClass("patt-hidden")}$(this).on(r+".pattern-move",function(e){f.call(this,e,t)});$(document).one(n,function(){l.call(this,e,t)});var o=i.holder.find(".patt-wrap"),u=o.offset();i.wrapTop=u.top,i.wrapLeft=u.left;t.reset()},f=function(e,t){e.preventDefault();var n=e.pageX||e.originalEvent.touches[0].pageX,r=e.pageY||e.originalEvent.touches[0].pageY,i=s[t.token],o=i.pattCircle,a=i.patternAry,f=i.option.lineOnMove,l=i.getIdxFromPoint(n,r),c=l.idx,h=i.mapperFunc(c)||c;if(a.length>0){var p=u(i.lineX1,l.x,i.lineY1,l.y);i.line.css({width:p.length+10+"px",transform:"rotate("+p.angle+"deg)"})}if(c){if(a.indexOf(h)==-1){var d=$(o[c-1]);d.addClass("hovered");a.push(h);var v=i.option.margin,m=i.option.radius,g=(l.i-1)*(2*v+2*m)+2*v+m;newY=(l.j-1)*(2*v+2*m)+2*v+m;if(a.length!=1){var y=u(i.lineX1,g,i.lineY1,newY);i.line.css({width:y.length+10+"px",transform:"rotate("+y.angle+"deg)"});if(!f)i.line.show()}var b=$('<div class="patt-lines" style="top:'+(newY-5)+"px; left:"+(g-5)+'px"></div>');i.line=b;i.lineX1=g;i.lineY1=newY;i.holder.append(b);if(!f)i.line.hide()}}},l=function(e,t){e.preventDefault();var n=s[t.token],r=n.pattCircle,i=n.patternAry.join("");n.holder.off(".pattern-move").removeClass("patt-hidden");if(!i)return;n.option.onDraw(i);n.line.remove();if(n.rightPattern){if(i==n.rightPattern){n.onSuccess()}else{n.onError();t.error()}}};c.prototype={constructor:c,getIdxFromPoint:function(e,t){var n=this.option,r=n.matrix,i=e-this.wrapLeft,s=t-this.wrapTop,o=null,u=n.margin,a=n.radius*2+u*2;qsntX=Math.ceil(i/a),qsntY=Math.ceil(s/a),remX=i%a,remY=s%a;if(qsntX<=r[1]&&qsntY<=r[0]&&remX>u*2&&remY>u*2){o=(qsntY-1)*r[1]+qsntX}return{idx:o,i:qsntX,j:qsntY,x:i,y:s}}};h.prototype={constructor:h,option:function(e,t){var n=s[this.token],r=n.option;if(!t){return r[e]}else{r[e]=t;if(e=="margin"||e=="matrix"||e=="radius"){o(n)}}},getPattern:function(){return s[this.token].patternAry.join("")},reset:function(){var e=s[this.token];e.pattCircle.removeClass("hovered");e.holder.find(".patt-lines").remove();e.patternAry=[];e.holder.removeClass("patt-error")},error:function(){s[this.token].holder.addClass("patt-error")},checkForPattern:function(e,t,n){var r=s[this.token];r.rightPattern=e;r.onSuccess=t||i;r.onError=n||i}};h.defaults={matrix:[3,3],margin:20,radius:25,patternVisible:true,lineOnMove:true};window.PatternLock=h})();